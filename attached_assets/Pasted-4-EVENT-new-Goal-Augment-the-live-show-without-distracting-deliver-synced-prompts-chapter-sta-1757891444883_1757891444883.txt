4) EVENT (new)

Goal: Augment the live show without distracting; deliver synced prompts, chapter stamps, light tasks and a keepsake, all resilient to low light and poor signal.

4.1 Entry Conditions & Session State

Auto‑switch to Event when either:

Device enters venue geofence (radius configurable per venue) and time ∈ [H‑1, H+4]; or

Show QR at entrance is scanned.

Both set in_show=true on the active ticket and start a Show Session (expiry: event end + 60 min). Re‑entry resumes the same session.

If signal is lost, the app remains in Event (Offline); all critical flows queue for sync.

Manual Exit Event Mode control hidden behind a long‑press in Settings (to avoid accidental exit).

4.2 Timecode & Sync

Show Clock: local monotonic timer started at session begin.

Operator Heartbeat (WebSocket) carries server timecode every 1 s; client smooths drift via linear correction (max ±250 ms/min).

Fallback: if heartbeat missing >10 s, client uses local clock; warns operator in console.

OSC/Webhook Bridge (optional): operator console can emit OSC to FOH systems; the app never requires OSC inbound.

4.3 Audience UX (mobile)

Now/Next rail fixed at top; large Scan button and compact Help button always visible.

Low‑light theme (true black, large type), haptics on key actions, no forced brightness.

Heads‑up mode: full‑screen dark screen with a single on‑screen cue when the show requests minimal phone glow.

4.4 Cue Types & Schema

Each cue is pre‑authored in CMS and may be re‑timed live.

{
  "id": "cue_17",
  "type": "TEXT|QR_PROMPT|POLL|TASK|KEEPSAKE|BROADCAST|PAUSE|RESUME",
  "timecode": "00:12:34.500",
  "open_offset_ms": -5000,
  "close_offset_ms": 20000,
  "priority": 0,
  "payload": { /* type‑specific */ },
  "unlock_rules": [/* optional */]
}

TEXT: short copy, optional image.

QR_PROMPT: instructs users to scan the chapter title on stage.

POLL: question + options (2–5), optional live results.

TASK: device‑motion or mic‑level challenge with threshold.

KEEPSAKE: opens camera with themed mask and watermark.

BROADCAST: operator push message (e.g., safety note).

PAUSE/RESUME: temporarily suppress audience UI (e.g., quiet moment).

4.5 Chapter QR — Design & Pipeline

Physical: high‑contrast QR adjacent to each chapter title. Recommended minimum: 300 mm square at 8–15 m viewing distance (module size ≥10 mm), matte finish, 60–80% contrast.

Code format (versioned, short): E:<eventShort>|C:<chapter>|S:<seq>|V:1|H:<crc> → Base64URL.

Offline dictionary: a signed list of all valid codes for the active event ships with the show package.

Scan flow:

Camera → decode → validate against dictionary & CRC.

If new: award Chapter Stamp (idempotent); optionally grant a micro‑reward (frame/sticker); store local ack immediately (<300 ms).

Queue server sync. If duplicate: show subtle ‘Already stamped’ toast.

Error states: invalid/old event → polite message + offer to switch event; glare/no read → prompt to adjust angle.

4.6 Polls/Votes

Delivered via WebSocket; cached for 60 s.

Timing: open at timecode + open_offset, auto‑close at close_offset (default 20 s).

Display: large tap targets; optional animated results after close. No usernames; stored against ticket id.

Operator options: lock early, extend window, hide/show results, mark ‘decisive’ to emit webhook/OSC for FOH.

4.7 Light Tasks

Hold Steady: use gyroscope; success if variance < threshold for N seconds (device‑normalised).

Clap Rhythm: mic RMS level vs metronome; detects on‑beat claps without recording audio (no raw waveform persisted).

Safety: all tasks playable seated; never require movement in aisles; accessible alternative: ‘Press & Hold’.

4.8 Keystoned Keepsake

Capture: portrait camera with live mask (WebGL/Canvas); auto‑exposure bias for low light.

Branding: corner watermark (show/date/venue); optional chapter glyph overlay.

Output: 1080×1920 image or 4–6 s clip (H.264/AAC), size‑bounded <3 MB.

Privacy: processed locally; uploaded only to issue the wallet item; user can opt‑out of gallery sharing.

4.9 Help & Access

One‑tap categories: Access, First Aid, Lost Property, Technical.

If seat row provided at ticket claim, it’s included; otherwise optional free‑text.

Sends to Staff Console with timestamp; user receives ‘We’ve got your request’ receipt and FAQ links.

4.10 Operator Console (Staff role)

Session control: start/stop, set show offset, rehearsal mode (simulated audience).

Timeline: list of cues with current server timecode; drag to retime ±5 s; pin Spotlight to all devices.

Live counters: active users, scans/min, poll turnout, task pass rate, help queue.

Broadcast: push a message (rate‑limited; large text on client).

Failover: console shows connectivity health (WebSocket/venue Wi‑Fi); can trigger QR‑only fallback.

Roles: Operator, FOH Supervisor, Support (granular permissions).

4.11 Data & Telemetry (minimal)

Per ticket: cue receipt, poll choice, checkpoint ids, task completion. No personal audio/video stored.

Aggregated dashboards only during show; raw events anonymised and pruned after retention window (e.g., 30 days).

4.12 Performance, Offline & Resilience

Concurrency target: 500 concurrent devices per room (scalable by shard); WebSocket fan‑out via topic channels.

Offline: QR scans, tasks and keepsake capture fully offline; background sync retries with exponential back‑off.

Latency: poll push → audience display <1.5 s on venue Wi‑Fi; QR local ack <300 ms; server ack <2 s.

Battery: camera sessions time‑boxed; frame‑throttled UI at 30 fps; haptics minimal.

4.13 Accessibility

Large text option, haptic confirmations, captions on any in‑app video, screen‑reader labels, high‑contrast palette, no rapid flashing.

4.14 QA Checklist (Event)

Low‑light QR readability (lux < 20); glare tests on glossy stage signage.

Airplane mode: scans queue and later sync; polls suppressed with clear ‘Offline’ banner.

Congested Wi‑Fi: poll delivery under 1.5 s (P95); WebSocket reconnect jitter < 3 s.

Idempotency: repeated scans/polls don’t duplicate rewards.

Emergency broadcast renders within 1 s on 95% of devices.

4.15 Event AR Experiences (new)

Goal: Optional, low‑glow AR moments that heighten key chapters without distracting from stage action. All AR runs locally, for ≤20 s per scene, with safe, seated interactions.

4.15.1 Capability Targeting

Tier 0 (Fallback): no AR support → show short looped video overlay matching the scene.

Tier 1: Face/portrait effects (front camera) — guaranteed across most devices.

Tier 2: Image‑tracked AR using chapter anchors (seat cards or stage placards).

Tier 3: World‑locked AR (plane tracking) anchored near the user’s seat for brief loops.

Device Pre‑Flight at Event entry sets the best available tier and preloads assets.

4.15.2 Anchors & Props

Seat Card Anchors (preferred): A6 cards placed on seats with a high‑contrast chapter glyph + subtle fiducial (AprilTag/ArUco) encoded as AR_ANCHOR:<event>:<chapter>:v1.

Stage Placard Anchors: A3/A2 chapter title boards double as image targets for users near the front rows.

QR vs AR: The visible QR triggers the scene download/unlock. Tracking uses the glyph (image target) rather than the QR itself.

4.15.3 Scene Catalogue (Ode Islands example)

Dream Garden (Before Act): Particle bloom (petals/orbs) emanate from the seat card; gentle chime. Interaction: tap to hatch 3 blossoms → adds a tiny frame to wallet.

Escape: Glass‑shard burst that ‘reforms’ into a doorway frame. Interaction: press‑and‑hold 3 s to “push through”.

Storm: Red Nors cloud vortex hovering 0.5 m above seat; subtle rumble. Interaction: hold phone steady 5 s to calm → cloud fades to Orans gold edge.

Womb Room: Warm, soft pulsing sphere with faint heartbeat and glints. Interaction: slow inhale/exhale guided with on‑screen ring (mic level only) → sphere brightens; capture prompt appears.

Nors & Orans Split: Foreground/Background parallax bands the user aligns with a slider; when aligned, a glyph locks in and saves a sticker.

Each scene ships as a bundle (<2.5 MB) with mesh (Draco), textures (1024 atlas, WebP/AVIF), and audio (<200 KB).

4.15.4 UX & Safety

Low‑glow mode: dark UI, no forced brightness, black background; haptic confirmations instead of flash.

Seated‑safe: no walking or standing required; alternative ‘Press & Hold’ path for tasks.

Session timer: AR auto‑closes after 20 s or when operator marks a quiet moment.

Operator gate: AR availability toggled per chapter; console can send PAUSE AR.

4.15.5 Capture & Keepsake

Single‑tap Capture during AR produces a postcard (1080×1920) with watermark (show/date/venue) + chapter glyph.

Saved to Wallet instantly (offline) and queued for sync; user can opt‑in to Gallery share.

4.15.6 Performance Budgets

30 fps on mid‑range Android; draw calls ≤150; tris ≤300k; shader complexity minimal (unlit + additive preferred).

Total Event AR pack target <10 MB per show; per‑scene cold start <1.0 s once preloaded.

4.15.7 Analytics (minimal)

Scene opens/closes, completion of interaction, capture yes/no; no face landmarks or raw mic data stored.

4.15.8 QA

Low‑light focus and exposure tests; anchor detection at 30–80 cm for seat cards, 3–8 m for stage placards.

Motion‑blur tolerance (slow shutter); verify scene stability under ±5° hand shake.

Offline run: all scenes launch from cache; captures queue and sync on reconnection.